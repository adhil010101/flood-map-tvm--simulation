<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Flood Alert Navigation - Trivandrum</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<style>
  body { margin: 0; padding: 0; }
  #map { width: 100%; height: 100vh; }
  .control-buttons {
    position: absolute;
    top: 10px;
    left: 50px;
    z-index: 1000;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0px 0px 10px rgba(0,0,0,0.3);
  }
  .alert {
    background: red;
    color: white;
    padding: 5px;
    margin-top: 5px;
    font-weight: bold;
    border-radius: 5px;
    animation: blink 1s infinite;
  }
  @keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
  }
</style>
</head>
<body>

<div id="map"></div>
<div class="control-buttons">
  <label>Destination: </label>
  <select id="destination">
    <option value="8.5241,76.9366">Trivandrum Central</option>
    <option value="8.5482,76.9366">Medical College</option>
    <option value="8.5392,76.9784">Kazhakoottam</option>
  </select>
  <button onclick="planRoute()">Go</button>
  <div id="alertBox"></div>
</div>

<script>
let map = L.map('map').setView([8.5241, 76.9366], 13);

// Base map
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Flood zones simulation
let highFlood = L.circle([8.5300, 76.9400], { radius: 800, color: "red", fillColor: "red", fillOpacity: 0.4 }).addTo(map);
let mediumFlood = L.circle([8.5200, 76.9500], { radius: 700, color: "blue", fillColor: "blue", fillOpacity: 0.3 }).addTo(map);
let lowFlood = L.circle([8.5350, 76.9600], { radius: 600, color: "yellow", fillColor: "yellow", fillOpacity: 0.3 }).addTo(map);

// Route planning with GraphHopper
function planRoute() {
  let start = [8.5241, 76.9366]; // Default starting point
  let dest = document.getElementById('destination').value.split(",");
  let end = [parseFloat(dest[0]), parseFloat(dest[1])];

  let apiKey = "363c2df2-baa1-4e35-b1b9-9ceb7fc3eed1";
  let url = `https://graphhopper.com/api/1/route?point=${start[0]},${start[1]}&point=${end[0]},${end[1]}&vehicle=car&points_encoded=false&key=${apiKey}`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      if (!data.paths || data.paths.length === 0) {
        alert("No route found!");
        return;
      }

      let coords = data.paths[0].points.coordinates.map(c => [c[1], c[0]]);
      L.polyline(coords, { color: "red", weight: 5, dashArray: "5, 10" }).addTo(map);

      // Alternative safe route simulation (Green)
      let safeCoords = coords.map(([lat, lon]) => [lat + 0.002, lon + 0.002]);
      L.polyline(safeCoords, { color: "green", weight: 5 }).addTo(map);

      document.getElementById('alertBox').innerHTML = `<div class="alert">Flooded road detected! Alternative route in green.</div>`;
    })
    .catch(err => {
      console.error(err);
      alert("Error fetching route. Check API key or network.");
    });
}
</script>

</body>
</html>
