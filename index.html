<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Trivandrum Flood Navigation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f4f4f4; }
  #map { height: 90vh; width: 100%; }
  .controls {
    padding: 10px; background: white; display: flex; gap: 10px; 
    justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
  .dark-mode { background:#222; color:white; }
  .dark-mode .controls { background:#333; }
  .btn {
    padding: 8px 12px; border:none; cursor:pointer; border-radius:5px;
    background:#007bff; color:white; font-weight:bold;
  }
  .btn:hover { opacity:0.9; }
</style>
</head>
<body>

<div class="controls">
  <input type="text" id="start" placeholder="Start (lat,lng)">
  <input type="text" id="end" placeholder="Destination (lat,lng)">
  <button class="btn" onclick="findRoute()">Get Route</button>
  <button class="btn" onclick="toggleMode()">Light/Dark</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
let darkMode = false;
let map = L.map('map').setView([8.5241, 76.9366], 13);

// Base layers
let lightLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' });
let darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '© OpenStreetMap & CARTO' });
lightLayer.addTo(map);

function toggleMode(){
  if(darkMode){ map.removeLayer(darkLayer); lightLayer.addTo(map); document.body.classList.remove("dark-mode"); }
  else { map.removeLayer(lightLayer); darkLayer.addTo(map); document.body.classList.add("dark-mode"); }
  darkMode = !darkMode;
}

// Flood zones simulation
function addFloodZones(){
  L.circle([8.5200, 76.9350], {radius: 500, color:"red", fillOpacity:0.3}).addTo(map).bindPopup("High Flood Risk");
  L.circle([8.5300, 76.9400], {radius: 400, color:"blue", fillOpacity:0.3}).addTo(map).bindPopup("Possible Flood");
  L.circle([8.5400, 76.9450], {radius: 300, color:"yellow", fillOpacity:0.3}).addTo(map).bindPopup("Low Rain Risk");
}
addFloodZones();

// GraphHopper routing
function findRoute(){
  let startVal = document.getElementById("start").value.split(",");
  let endVal = document.getElementById("end").value.split(",");
  let startLat = parseFloat(startVal[0]), startLng = parseFloat(startVal[1]);
  let endLat = parseFloat(endVal[0]), endLng = parseFloat(endVal[1]);

  fetch(`https://graphhopper.com/api/1/route?point=${startLat},${startLng}&point=${endLat},${endLng}&vehicle=car&locale=en&points_encoded=false&key=363c2df2-baa1-4e35-b1b9-9ceb7fc3eed1`)
  .then(res => res.json())
  .then(data => {
    if(data.paths && data.paths.length > 0){
      let coords = data.paths[0].points.coordinates.map(c => [c[1], c[0]]);
      L.polyline(coords, {color:"blue", weight:5, dashArray:"5,10"}).addTo(map).bindPopup("Main Route");

      // Simulate a flood in the route & give alternative
      L.polyline([[8.528, 76.94], [8.532, 76.942]], {color:"red", weight:5, dashArray:"5,5"}).addTo(map).bindPopup("Flooded Area");
      let altCoords = [
        [startLat, startLng],
        [8.526, 76.938],
        [8.534, 76.946],
        [endLat, endLng]
      ];
      L.polyline(altCoords, {color:"green", weight:5, dashArray:"5,5"}).addTo(map).bindPopup("Alternative Safe Route");

      map.fitBounds(L.latLngBounds(coords));
    } else {
      alert("No route found");
    }
  })
  .catch(err => console.error(err));
}

// Live location
map.locate({setView:true, maxZoom:15, watch:true});
map.on('locationfound', e => {
  L.marker(e.latlng).addTo(map).bindPopup("You are here").openPopup();
});
</script>

</body>
</html>
